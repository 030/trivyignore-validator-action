setup() {
  filename=".trivyignore"

  echo -en "CVE-123\nCVE-456 exp:2124-02-16" > "${filename}"
}

teardown() {
  echo "found filename: '${filename}'. Removing it..."
  rm "${filename}"
}

@test "inspect cve expiry" {
  run ./src/action.sh
  [ "$status" -eq 1 ]
  regex=".*no expiry associated to: 'CVE-123'. Add it by adding: 'exp:yyyy-mm-dd'.*"
  [[ "$output" =~ $regex ]]
}
